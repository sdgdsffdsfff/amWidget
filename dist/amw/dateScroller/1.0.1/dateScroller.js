window.AW=window.AW||{},function(){"use strict";function t(t){return t=parseInt(t),t%4==0&&t%100!=0||t%400==0}function e(t,e,n){for(var r=[],i=t;e>=i;i++)r.push({name:i+n,value:i});return r}function n(e,n){var r=t(e);n=parseInt(n);var i=[31,28,31,30,31,30,31,31,30,31,30,31];return 2==n&&r?29:i[n-1]}function r(t,e){var n={Y:t.getYear(),y:t.getYear(),M:t.getMonth(),m:t.getMonth(),D:t.getDay(),d:t.getDay()};return e.replace(/([YyMmDd])+/g,function(t,e){switch(e){case"y":return n[e].toString().slice(-t.length);case"Y":return n[e].toString().slice(-t.length);default:return((t.length>1?"0":"")+n[e]).slice(-2)}})}var i=function(t){if(this.container=t.container,!this.container)return!1;var e=new Date;this.defaultDate=t.defaultDate||{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()},this.min_date={year:1980,month:1,day:1},this.max_date={year:2025,month:12,day:31},this._initScrollers(),this.select(this.defaultDate)};i.prototype={_initScrollers:function(){var r=this,i=this.defaultDate,a=n(i.year,i.month);this.yearScroller=new p({id:"year-scroller",container:this.container,data:e(r.min_date.year,r.max_date.year,"年"),selectedCallback:function(i,a){if(i!=a){var s=t(i),l=t(a);if(s!=l){var o=r.monthScroller,c=r.dayScroller;i=parseInt(i),a=parseInt(a);var u=parseInt(o.getValue()),h=parseInt(c.getValue()),d=n(i,u),f=e(1,d,"日");2!=u||29!=h||s?(c.render(f),c.select(h)):(c.render(f),c.select(h-1))}}}}),this.monthScroller=new p({id:"month-scroller",container:this.container,data:e(1,12,"月"),selectedCallback:function(t,i){if(t!=i){var a=r.yearScroller.getValue(),s=n(a,t),l=n(a,i);if(s!=l){var o=e(1,s,"日"),c=r.dayScroller,u=parseInt(c.getValue());u=r._calcNearestValue(u,s,l),c.render(o),c.select(u)}}}}),this.dayScroller=new p({id:"day-scroller",container:this.container,data:e(1,a,"日")})},_calcNearestValue:function(t,e,n){return e>=n?t:t>e?e:t},select:function(t){t.year&&this.yearScroller.selectThenCallback(t.year),t.month&&this.monthScroller.selectThenCallback(t.month),t.day&&this.dayScroller.select(t.day)},getValue:function(t){if(!t)return this.getYear()+"-"+this.getMonth()+"-"+this.getDay();var e={year:this.yearScroller.getValue(),month:this.monthScroller.getValue(),day:this.dayScroller.getValue()};return e},getYear:function(){return this.yearScroller.getValue()},getMonth:function(){return this.monthScroller.getValue()},getDay:function(){return this.dayScroller.getValue()}};var a=44,s=2,l=a*s,o=3,c=200,u=1e3,h=.2,d=.1,f=a*(s+1),v="scroller-item",m='<div class="scroller-component"> 	  <div class="mask"></div> 	  <div class="current-indicator"></div> 	  <div class="scroller"></div> 	</div>',p=window.Scroller=function(t){var e=document.createElement("div");e.innerHTML=m,this.scrollerComponent=e.firstElementChild,this.scroller=this.scrollerComponent.lastElementChild,t=t||{};var n=t.container;n&&1==n.nodeType&&n.appendChild(this.scrollerComponent),t.id&&this.scrollerComponent.setAttribute("id",t.id),t.data&&this.render(t.data),this.callback=t.selectedCallback,this._resetHeight(),this.startYInMove=0,this.touch=null,this._init()};p.prototype={currentValue:null,prevValue:null,_init:function(){this._setTransitionDuratoin(h),this._bindEvents()},_bindEvents:function(){var t,e,n,r,i,h,f=this,v=this.scroller,m=this.scrollerComponent,p=this.parentHeight,g=!1;m.addEventListener("touchstart",function(e){if(e.preventDefault(),f._setTransitionDuratoin(0),g){g=!1;var n=new WebKitCSSMatrix(window.getComputedStyle(f.scroller).webkitTransform),r=n.f;r!=h&&(document.removeEventListener("webkitTransitionEnd",f.scroller,!1),f._setTransformY(r)),n=new WebKitCSSMatrix(window.getComputedStyle(f.scroller).webkitTransform)}var i=e.changedTouches[0];t=+new Date,f.startY=f.startYInMove=i.clientY,clearTimeout(f.callbackTimer)},!1),m.addEventListener("touchmove",function(t){t.preventDefault(),f.touch=t.changedTouches[0],f._setPosition()},!1),m.addEventListener("touchend",function(m){var y=m.changedTouches[0],T=+new Date,b=f._getCurrentTransitionY();if(n=b,c>T-t){e=y.clientY-f.startY;var S=Math.abs(e)/(T-t)/o;0>e?(r=Math.abs(-(f.scrollerHeight-p)-b)/S,h=-(f.scrollerHeight-p)-l):(r=Math.abs(b)/S,h=l),r>u&&(r=u,i=S*r,h=0>e?b-i:b+i),h=Math.round(h/a)*a,r/=1e3}else r=d,h=Math.round(b/a)*a;h>l?h=l:h<f.minTransitionY+a&&(h=f.minTransitionY+a),Math.abs(h-b)<l&&(r=d),g=!0,f._setTransitionDuratoin(r),f._setTransformY(h);var w=Math.abs(h/a-s),C=v.children[parseInt(w)];C&&(r=1e3*r,f.prevValue=f.currentValue,f.currentValue=C.dataset.value,"function"==typeof f.callback&&f.callback(f.currentValue,f.prevValue),f.callbackTimer=setTimeout(function(){g=!1},r)),f.touch=null},!1)},_resetHeight:function(){this.scrollerHeight=this.scroller.clientHeight,this.parentHeight=this.scrollerComponent.clientHeight,this.minTransitionY=-(this.scrollerHeight+f-this.parentHeight)},_setPosition:function(t){if(t=t||this.touch){var e=t.clientY,n=e-this.startYInMove,r=this._getCurrentTransitionY(),i=r+n;i>f?i=f:i<this.minTransitionY&&(i=this.minTransitionY),this._setTransformY(i),this.startYInMove=e}},_setTransitionDuratoin:function(t){var e="all "+t+"s ease-out";this.scroller.style.webkitTransition=e,this.scroller.style.transition=e},_setTransformY:function(t){this.scroller.style.webkitTransform=C+"(0, "+t+"px"+V},_getCurrentTransitionY:function(){var t=this.scroller.style.getPropertyCSSValue("-webkit-transform");return t?parseFloat(t[0][1].cssText):0},selectByIndex:function(t){var e=this.scroller;if(0>t||t>e.childElementCount-1)return!1;var n=l-a*t;this._setTransitionDuratoin(h),this._setTransformY(n);var r=e.children[t];this.prevValue=this.currentValue,this.currentValue=r.dataset.value},select:function(t){if(void 0===t||null===t)return this;for(var e=this.scroller.children,n=0,r=e.length;r>n;n++)if(e[n].dataset.value==t)return void this.selectByIndex(n);return this},selectThenCallback:function(t){return this.select(t),"function"==typeof this.callback&&this.callback(this.currentValue,this.prevValue),this},getValue:function(){return this.currentValue},setSelectedCallback:function(t){return this.callback=t,this},render:function(t){if(!t||0==t.length||t.constructor!==Array)return!1;var e="";return t.forEach(t[0].constructor===Object?function(t){e+='<div class="'+v+'" data-value="'+t.value+'">'+t.name+"</div>"}:function(t){e+='<div class="'+v+'" data-value="'+t+'">'+t+"</div>"}),this.scroller.innerHTML=e,this._resetHeight(),this}},window.onload=function(){var t,e,n,a=document.body,s=(document.getElementsByTagName("input"),a.querySelectorAll("input[data-type='date']"));a.style.height="auto";var l=a.clientHeight,o=window.innerHeight;if(s[0]){for(var c=s.length,u=0;c>u;u++)s[u].setAttribute("readOnly","readonly");t=document.createElement("div"),t.id="ds-container";var h=document.createElement("div");h.id="ds-optionWrapper";var d=document.createElement("span");d.id="ds-confirm",d.className="ds-btn",d.innerHTML="确定";var f=document.createElement("span");f.id="ds-cancel",f.className="ds-btn",f.innerHTML="取消",h.appendChild(f),h.appendChild(d),t.appendChild(h),document.body.appendChild(t),n=new i({container:byId("ds-container")}),t.style.display="none",a.addEventListener(S,function(i){var s=i.target,c=s.nodeName.toUpperCase();if("INPUT"==c){var u=s.getAttribute("data-type");u&&"date"==u?(s.setAttribute("readOnly","readonly"),e=s,setTimeout(function(){t.style.display="block";var n=a.scrollTop||document.documentElement.scrollTop,r=e.offsetTop+e.offsetHeight,i=o-(r-n),s=t.offsetHeight;if(a.style.height=l+s+"px",s>=i){var c=s-i;a.scrollTop=n+c}},300)):(t.style.display="none",a.style.height=l+"px")}if("ds-confirm"==s.id){var h=n.getValue(!1),d=e.getAttribute("data-format");d?e.value=r(n,d):e.value=h,t.style.display="none",a.style.height=l+"px"}"ds-cancel"==s.id&&(t.style.display="none",a.style.height=l+"px")},!1)}};var g=/iphone/gi.test(navigator.appVersion),y=/ipad/gi.test(navigator.appVersion),T=/android/gi.test(navigator.appVersion),b=g||y||T,S=b?"touchend":"mouseup",w=!("WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix),C=w?"translate3d":"translate",V=w?", 0)":")";window.AW.DateScroller=i}();